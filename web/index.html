<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent Cron Scheduler</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- ================================================================== -->
  <!-- Header                                                             -->
  <!-- ================================================================== -->
  <header class="app-header">
    <div class="header-left">
      <h1 class="app-title">Agent Cron Scheduler</h1>
    </div>
    <div class="header-right">
      <span class="health-indicator" id="health-indicator">
        <span class="health-dot" id="health-dot"></span>
        <span class="health-text" id="health-text">Connecting...</span>
      </span>
      <span class="uptime" id="uptime-display"></span>
    </div>
  </header>

  <!-- ================================================================== -->
  <!-- Main Content                                                       -->
  <!-- ================================================================== -->
  <main class="main-content">
    <!-- Toolbar -->
    <div class="toolbar">
      <h2 class="section-title">Jobs</h2>
      <button class="btn btn-primary" id="btn-add-job">+ Add Job</button>
    </div>

    <!-- Job Table -->
    <div class="table-container">
      <table class="job-table" id="job-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Schedule</th>
            <th>Enabled</th>
            <th>Last Run</th>
            <th>Next Run</th>
            <th>Exit Code</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="job-table-body">
          <tr class="empty-row">
            <td colspan="7" class="empty-message">Loading jobs...</td>
          </tr>
        </tbody>
      </table>
    </div>

  </main>

  <!-- ================================================================== -->
  <!-- Job Detail Sidebar                                                 -->
  <!-- ================================================================== -->
  <div class="sidebar-backdrop" id="sidebar-backdrop"></div>
  <aside class="job-sidebar" id="job-sidebar">
    <div class="sidebar-header">
      <h2 class="sidebar-title" id="sidebar-job-name">Job Details</h2>
      <div class="sidebar-actions">
        <button class="btn btn-sm sidebar-action-btn" id="btn-sidebar-run" title="Run now">
          <i data-lucide="play"></i> <span>Run</span>
        </button>
        <button class="btn btn-sm sidebar-action-btn" id="btn-sidebar-edit" title="Edit job">
          <i data-lucide="pencil"></i> <span>Edit</span>
        </button>
        <button class="btn btn-sm btn-danger sidebar-action-btn" id="btn-sidebar-delete" title="Delete job">
          <i data-lucide="trash-2"></i> <span>Delete</span>
        </button>
        <div class="sidebar-action-group">
          <button class="btn btn-sm sidebar-action-btn" id="btn-refresh-runs" title="Refresh runs">
            <i data-lucide="refresh-cw"></i> <span>Refresh</span>
          </button>
          <button class="btn-icon sidebar-close" id="btn-close-sidebar" title="Close">
            <i data-lucide="x"></i>
          </button>
        </div>
      </div>
    </div>
    <div class="sidebar-body">
      <div class="runs-list-panel" id="runs-list-panel">
        <div class="runs-list-header">Runs</div>
        <div class="runs-list" id="runs-list">
          <div class="runs-empty">No runs yet</div>
        </div>
      </div>
      <div class="sidebar-log-section">
        <div class="sidebar-log-header">
          <span class="sidebar-log-title">Log Output</span>
          <button class="btn btn-sm sidebar-action-btn" id="btn-clear-log" title="Clear log">
            <i data-lucide="eraser"></i> <span>Clear</span>
          </button>
        </div>
        <div class="log-output" id="log-output"></div>
      </div>
    </div>
  </aside>

  <!-- ================================================================== -->
  <!-- Job Modal (Add / Edit)                                             -->
  <!-- ================================================================== -->
  <div class="modal-overlay" id="modal-overlay">
    <div class="modal" id="job-modal">
      <div class="modal-header">
        <h2 class="modal-title" id="modal-title">Add Job</h2>
        <button class="modal-close" id="modal-close">&times;</button>
      </div>
      <form id="job-form" class="modal-body">
        <input type="hidden" id="form-job-id">

        <!-- Row 1: Name and Execution Type -->
        <div class="form-row">
          <div class="form-group">
            <label for="form-name">Name</label>
            <input type="text" id="form-name" required placeholder="my-backup-job" autocomplete="off">
          </div>
          <div class="form-group">
            <label for="form-exec-type">Execution Type</label>
            <select id="form-exec-type">
              <option value="ShellCommand">Shell Command</option>
              <option value="ScriptFile">Script File</option>
            </select>
          </div>
        </div>

        <!-- Row 2: Command (full width) -->
        <div class="form-group">
          <label for="form-exec-value" id="form-exec-value-label">Command</label>
          <input type="text" id="form-exec-value" required placeholder="echo hello" autocomplete="off">
        </div>

        <!-- Row 3: Schedule section -->
        <div class="form-group">
          <label>Schedule</label>
          <div class="schedule-tabs">
            <button type="button" class="schedule-tab active" data-mode="simple" id="tab-simple">Simple</button>
            <button type="button" class="schedule-tab" data-mode="cron" id="tab-cron">Cron</button>
          </div>
          <div class="schedule-panel" id="panel-simple">
            <div class="form-row">
              <div class="form-group form-group-inline">
                <label for="form-frequency">Frequency</label>
                <select id="form-frequency">
                  <option value="every_minutes">Every N minutes</option>
                  <option value="hourly">Hourly</option>
                  <option value="daily">Daily</option>
                  <option value="weekly">Weekly</option>
                  <option value="monthly">Monthly</option>
                </select>
              </div>
              <div class="form-group form-group-inline" id="group-interval">
                <label for="form-interval">Interval</label>
                <input type="number" id="form-interval" min="1" max="59" value="5" autocomplete="off">
              </div>
              <div class="form-group form-group-inline" id="group-time" style="display:none;">
                <label for="form-time">Time</label>
                <input type="time" id="form-time" value="09:00">
              </div>
              <div class="form-group form-group-inline" id="group-day-of-week" style="display:none;">
                <label for="form-dow">Day</label>
                <select id="form-dow">
                  <option value="0">Sunday</option>
                  <option value="1">Monday</option>
                  <option value="2">Tuesday</option>
                  <option value="3">Wednesday</option>
                  <option value="4">Thursday</option>
                  <option value="5">Friday</option>
                  <option value="6">Saturday</option>
                </select>
              </div>
              <div class="form-group form-group-inline" id="group-day-of-month" style="display:none;">
                <label for="form-dom">Day</label>
                <input type="number" id="form-dom" min="1" max="31" value="1" autocomplete="off">
              </div>
              <div class="form-group form-group-inline" id="group-minute" style="display:none;">
                <label for="form-minute">Minute</label>
                <input type="number" id="form-minute" min="0" max="59" value="0" autocomplete="off">
              </div>
            </div>
            <div class="schedule-preview" id="schedule-preview">Every 5 minutes</div>
          </div>
          <div class="schedule-panel" id="panel-cron" style="display:none;">
            <input type="text" id="form-schedule" placeholder="*/5 * * * *" autocomplete="off">
            <span class="form-hint">5-field cron: minute hour day-of-month month day-of-week</span>
          </div>
        </div>

        <!-- Row 4: Timezone and Working Directory -->
        <div class="form-row">
          <div class="form-group">
            <label for="form-timezone">Timezone <span class="label-optional">(optional)</span></label>
            <input type="text" id="form-timezone" placeholder="UTC" autocomplete="off">
            <span class="form-hint">IANA timezone, e.g. America/New_York</span>
          </div>
          <div class="form-group">
            <label for="form-working-dir">Working Directory <span class="label-optional">(optional)</span></label>
            <input type="text" id="form-working-dir" placeholder="/home/user/project" autocomplete="off">
          </div>
        </div>

        <!-- Row 5: Environment Variables (full width) -->
        <div class="form-group">
          <label for="form-env-vars">Environment Variables <span class="label-optional">(optional)</span></label>
          <textarea id="form-env-vars" rows="3" placeholder="KEY=VALUE&#10;ANOTHER=value2"></textarea>
          <span class="form-hint">One per line: KEY=VALUE</span>
        </div>

        <!-- Row 6: Log Environment checkbox -->
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="form-log-env">
            Include full environment in run logs
          </label>
          <span class="form-hint">When enabled, all environment variables are logged before each run (useful for debugging)</span>
        </div>

        <div class="form-actions">
          <button type="button" class="btn" id="btn-cancel-form">Cancel</button>
          <button type="submit" class="btn btn-primary" id="btn-submit-form">Create Job</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ================================================================== -->
  <!-- Delete Confirmation Modal                                          -->
  <!-- ================================================================== -->
  <div class="modal-overlay" id="delete-overlay">
    <div class="modal modal-sm">
      <div class="modal-header">
        <h2 class="modal-title">Confirm Delete</h2>
        <button class="modal-close" id="delete-modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete job <strong id="delete-job-name"></strong>?</p>
        <p class="text-muted">This action cannot be undone.</p>
        <div class="form-actions">
          <button class="btn" id="btn-cancel-delete">Cancel</button>
          <button class="btn btn-danger" id="btn-confirm-delete">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ================================================================== -->
  <!-- Toast Container                                                    -->
  <!-- ================================================================== -->
  <div class="toast-container" id="toast-container"></div>

  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
